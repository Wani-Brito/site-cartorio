
document.addEventListener('DOMContentLoaded', function() {
  const input = document.getElementById('user-input');
  if (input) {
    input.addEventListener('input', function(e) {
      // Aceita apenas letras (mai√∫sculas/min√∫sculas), espa√ßos e acentos
      this.value = this.value.replace(/[^\p{L}\s]/gu, '');
    });
  }
});
document.addEventListener('DOMContentLoaded', function() {
  const chatWidget = document.querySelector('.chat-widget');
  const resizeBarLeft = document.querySelector('.chat-resize-left');
  let isResizingLeft = false;
  let startX = 0;
  let startWidth = 0;
  let startLeft = 0;

  if (chatWidget && resizeBarLeft) {
    resizeBarLeft.addEventListener('mousedown', function(e) {
      isResizingLeft = true;
      startX = e.clientX;
      startWidth = parseInt(window.getComputedStyle(chatWidget).width, 10);
      startLeft = chatWidget.offsetLeft;
      document.body.style.userSelect = 'none';
    });

    document.addEventListener('mousemove', function(e) {
      if (isResizingLeft) {
        const dx = e.clientX - startX;
        const newWidth = startWidth - dx;
        if (newWidth >= 200) {
          chatWidget.style.width = newWidth + 'px';
          chatWidget.style.left = (startLeft + dx) + 'px';
        }
      }
    });

    document.addEventListener('mouseup', function() {
      isResizingLeft = false;
      document.body.style.userSelect = '';
    });
  }
});
// Redimensionar altura do chat pelo topo (ajusta altura e top)
document.addEventListener('DOMContentLoaded', function() {
  const chatWidget = document.querySelector('.chat-widget');
  const resizeTop = document.querySelector('.chat-resize-top');
  let isResizing = false;
  let startY = 0;
  let startHeight = 0;
  const startTop = parseInt(document.defaultView.getComputedStyle(chatWidget).top, 10) || chatWidget.offsetTop;

  if (chatWidget && resizeTop) {
    resizeTop.addEventListener('mousedown', function(e) {
      isResizing = true;
      startY = e.clientY;
      startHeight = parseInt(window.getComputedStyle(chatWidget).height, 10);
      document.body.style.userSelect = 'none';
    });

    document.addEventListener('mousemove', function(e) {
      if (isResizing) {
        const delta = e.clientY - startY;
        let newHeight = startHeight - delta;
        let newTop = startTop + delta;
        if (newHeight > 200) {
          chatWidget.style.height = newHeight + 'px';
          chatWidget.style.top = newTop + 'px';
        }
      }
    });

    document.addEventListener('mouseup', function() {
      isResizing = false;
      document.body.style.userSelect = '';
    });
  }
});
const chatBox = document.getElementById("chat-box");
const userInput = document.getElementById("user-input");
const chatWidget = document.querySelector(".chat-widget");
const chatHeader = document.querySelector(".chat-header");

const intents = {
  "valor reconhecimento firma": [
    "valor reconhecimento",
    "valor reconhecimento firma",
    "quanto custa reconhecimento de firma",
    "pre√ßo firma assinatura",
    "firma valor assinatura",
    "firma",
    "reconhecimento firma",
    "reconhecimento de firma",
    "pre√ßo reconhecimento de assinatura",
    "quanto paga pra reconhecer firma",
    "tarifa reconhecimento firma",
    "quanto √© o reconhecimento de firma",
    "quanto custa firma reconhecida",
    "firma reconhecida valor"
  ],
  "documento": [
    "documento",
    "documentos",
    "documento necess√°rio",
    "precisa de quais documentos",
    "quais documentos",
    "documenta√ß√£o",
    "o que preciso levar",
    "pap√©is necess√°rios",
    "preciso levar quais documentos",
    "qual papel eu levo",
    "que documentos s√£o exigidos"
  ],
  "hor√°rio": [
    "hor√°rio",
    "hor√°rios",
    "qual o hor√°rio de funcionamento",
    "hor√°rio de atendimento",
    "hor√°rio de abertura",
    "hor√°rio de fechamento",
    "hor√°rio de expediente",
    "hor√°rio de trabalho",
    "hor√°rio de funcionamento cart√≥rio",
    "hor√°rio de funcionamento cart√≥rio civil",
    "hor√°rio de funcionamento cart√≥rio notarial",
  ],
  "valor casamento": [
    "valor casamento",
    "pre√ßo casamento",
    "quanto custa o casamento",
    "casamento valor",
    "taxa de casamento",
    "quanto pago pra casar",
    "qual o valor do registro de casamento",
    "quanto √© o casamento civil"
  ],
  "valor firma": [
    "valor firma",
    "pre√ßo firma",
    "quanto custa firma",
    "firma valor",
    "valor reconhceciento firma", 
    "firma assinatura",
    "firma reconhecimento",
    "valor pra abrir firma",
    "quanto √© pra reconhecer firma",
    "quanto √© abrir uma firma"
  ],
  "valor certidao": [
    "valor certidao",
    "pre√ßo certid√£o",
    "quanto custa certid√£o",
    "certid√£o valor",
    "taxa certid√£o",
    "qual valor da certid√£o de nascimento",
    "valor segunda via certid√£o",
    "certid√£o quanto custa"
  ],
  "documento casamento": [
    "casamento",
    "documento casamento",
    "pap√©is casamento",
    "quais documentos para casar",
    "casamento documento",
    "documentos pra casar no civil",
    "o que precisa para casamento",
    "documenta√ß√£o necess√°ria casamento",
    "registro casamento documentos"
  ],
  "documento firma": [
    "documento firma",
    "abrir firma",
    "reconhecimento documentos",
    "firma documento",
    "o que precisa para abrir firma",
    "documenta√ß√£o para firma",
    "documentos abrir firma",
    "documento reconhecimento de firma"
  ],
  "Ol√°": [
    "ola",
    "ol√°",
    "oi",
    "bom dia",
    "boa tarde",
    "boa noite",
    "e a√≠",
    "salve",
    "oii",
    "olaaa",
    "al√¥"
  ],
  "segunda via": [
    "segunda via casamento",
    "segunda via √≥bito",
    "segunda via nascimento",
    "segunda via certid√£o",
    "segunda via registro civil",
    "segunda via",
    "segunda via documento",
    "perdi minha certid√£o",
    "como tirar segunda via",
    "preciso de outra via",
    "duplicado certid√£o",
    "emitir segunda via"
  ],
  "escrituras": [
    "escritura",
    "escrituras",
    "fazer escritura",
    "registro escritura",
    "documento escritura",
    "escritura p√∫blica",
    "escritura de compra e venda",
    "escritura de doa√ß√£o",
    "escritura de invent√°rio"
  ],
  "procuracao": [
    "procura√ß√£o",
    "fazer procura√ß√£o",
    "registro procura√ß√£o",
    "documento procura√ß√£o",
    "procura√ß√£o p√∫blica",
    "como fazer procura√ß√£o",
    "modelo de procura√ß√£o",
    "preciso de procura√ß√£o"
  ]

};

userInput.addEventListener("keypress", function(event) {
  if (event.key === "Enter") {
    event.preventDefault();
    sendMessage();
  }
});

function sendMessage() {
  const message = userInput.value.trim();
  if (message === "") return;
  addMessage("Voc√™", message);
  respondToUser(message.toLowerCase());
  userInput.value = "";
}

function addMessage(sender, text) {
  const msg = document.createElement("div");
  msg.innerHTML = `<strong>${sender}:</strong> ${text}`;
  chatBox.appendChild(msg);
  chatBox.scrollTop = chatBox.scrollHeight;
}
function getIntent(message) {
  for (const intent in intents) {
    for (const phrase of intents[intent]) {
      if (message.includes(phrase)) {
        return intent;
      }
    }
  }
  return null;
}

function respondToUser(message) {
  const intent = getIntent(message);

  if (intent === "valor reconhecimento firma") {
    const msg = document.createElement("div");
    msg.innerHTML = `
      <strong>Bot:</strong> ‚úçÔ∏è Qual tipo de reconhecimento de firma?<br/><br/>
      <button onclick="respondToUser('reconhecimento por autenticacao')" class="chat-btn">üîê Por Autenticidade</button>
      <button onclick="respondToUser('reconhecimento por semelhanca')" class="chat-btn">üñãÔ∏è Por Semelhan√ßa</button>
    `;
    chatBox.appendChild(msg);
  }

  else if (intent === "Ol√°") {
    addMessage("Bot", "üëã Ol√°! Como posso ajudar? Voc√™ pode perguntar sobre documentos, hor√°rios, valores ou falar com um atendente.");
  }
  else if (intent === "valor casamento") {
    addMessage("Bot", "üí∏ O valor da habilita√ß√£o de casamento √© de R$ 400,00 (pode variar).");
  }

  else if (intent === "valor firma") {
    respondToUser("valor reconhecimento firma");
  }

  else if (intent === "valor certidao") {
    addMessage("Bot", "üìú Certid√µes custam R$ 46,00.");
  }

  else if (message.includes("reconhecimento por autenticacao")) {
    addMessage("Bot", "üîê Por autenticidade: R$ 15,00 (assinatura feita na presen√ßa do tabeli√£o).");
  }

  else if (message.includes("reconhecimento por semelhanca")) {
    addMessage("Bot", "üñãÔ∏è Por semelhan√ßa: R$ 8,00 (assinatura comparada com a ficha de firma).");
  }

  else if (intent === "documento casamento") {
    addMessage("Bot", "üë∞ Documentos para casamento: RG, CPF e certid√£o de nascimento atualizada dos noivos.");
  }

  else if (intent === "documento firma") {
    addMessage("Bot", "‚úçÔ∏è Para reconhecimento de firma: RG e CPF originais. A firma deve estar aberta no cart√≥rio.");
  }

  else if (message.includes("hor√°rio")) {
    addMessage("Bot", "üïí Funcionamos de segunda a sexta, das 8h30 √†s 16h30. O hor√°rio de almo√ßo √© das 12h00 √†s 13h00. Aos s√°bados os atendimentos s√£o voltados apenas para casamentos. ");
  }

  else if (message.includes("atendente")) {
    addMessage("Bot", "üìû Fale com a gente pelo WhatsApp: (19) 99999-9999.");
  }

  else if (message.includes("escritura")) {
    addMessage("Bot", "Para mais informa√ß√µes sobre escrituras, consulte a aba de Notas.");
  }
  else if (message.includes("procuracao")) {
    addMessage("Bot", "Para mais informa√ß√µes sobre procura√ß√£o, consulte a aba de Notas.");
  }


  else if (message.includes("primeira via") || message.includes("segunda via") || message.includes("certidao")) {
    const msg = document.createElement("div");
    msg.innerHTML = `
      <strong>Bot:</strong> üìÑ Voc√™ deseja a <strong>primeira</strong> ou <strong>segunda via</strong> da certid√£o?<br/><br/>
      <button onclick="respondToUser('primeira via')" class="chat-btn">Primeira via</button>
      <button onclick="respondToUser('segunda via')" class="chat-btn">Segunda via</button>
    `;
    chatBox.appendChild(msg);
      if (message.includes("primeira via")) {
        const msg = document.createElement("div");
        msg.innerHTML = `
          <strong>Bot:</strong> ‚úçÔ∏è De qual certid√£o voc√™ precisa a primeira via?<br/><br/>
          <button onclick="respondToUser('primeira-casamento')" class="chat-btn">Casamento</button>
          <button onclick="respondToUser('primeira-obito')" class="chat-btn">√ìbito</button>
          <button onclick="respondToUser('primeira-nascimento')" class="chat-btn">Nascimento</button>
        `;
        chatBox.appendChild(msg);
      }

      else if (message.includes("segunda via")) {
        const msg = document.createElement("div");
        msg.innerHTML = `
          <strong>Bot:</strong> ‚úçÔ∏è De qual certid√£o voc√™ precisa a segunda via?<br/><br/>
          <button onclick="respondToUser('segunda-casamento')" class="chat-btn">Casamento</button>
          <button onclick="respondToUser('segunda-obito')" class="chat-btn">√ìbito</button>
          <button onclick="respondToUser('segunda-nascimento')" class="chat-btn">Nascimento</button>
        `;
        chatBox.appendChild(msg);
      }
  }

    else if (message.includes("primeira-casamento")) {
      addMessage("Bot", "üë∞ A primeira via da certid√£o de casamento √© emitida no ato, ap√≥s o registro. Consulte o cart√≥rio ou clique na Aba de Registro Civis - Casamento");
    }
    else if (message.includes("primeira-obito")) {
      addMessage("Bot", "üïäÔ∏è A primeira via da certid√£o de √≥bito √© emitida gratuitamente no momento do registro.");
    }
    else if (message.includes("primeira-nascimento")) {
      addMessage("Bot", "üë∂ A primeira via da certid√£o de nascimento √© gratuita e emitida diretamente no cart√≥rio e n√£o h√° custos.");
    }

    else if (message.includes("segunda-casamento")) {
      addMessage("Bot", "üìÑ A segunda via da certid√£o de casamento custa R$ 46,23 + (valor de cada averba√ß√£o = R$23,20). Leve os principais dados do casamento.");
    }
    else if (message.includes("segunda-obito")) {
      addMessage("Bot", "üìÑ A segunda via da certid√£o de √≥bito custa R$ 46,23. Leve os principais dados do falescido.");
    }
    else if (message.includes("segunda-nascimento")) {
      addMessage("Bot", "üìÑ A segunda via da certid√£o de nascimento custa R$ 46,23 + (valor de cada averba√ß√£o = R$23,20). Leve os principais dados do casamento");
    }
    else if (message.includes("documento certidao")) {
      addMessage("Bot", "üìú Para solicitar certid√µes (nascimento, casamento ou √≥bito), traga um documento com foto e os dados do registro desejado.");
    }



  else if (message.includes("valor") || message.includes("valores")) {
    const msg = document.createElement("div");
    msg.innerHTML = `
      <strong>Bot:</strong> üí∞ Qual valor voc√™ quer saber?<br/><br/>
      <button onclick="respondToUser('valor casamento')" class="chat-btn">üë∞ Casamento</button>
      <button onclick="respondToUser('valor reconhecimento firma')" class="chat-btn">‚úçÔ∏è Firma</button>
      <button onclick="respondToUser('valor certidao')" class="chat-btn">üìú Certid√£o</button>
    `;
    chatBox.appendChild(msg);
  }
  else if (intent === "documento") {
    const msg = document.createElement("div");
    msg.innerHTML = `
      <strong>Bot:</strong> üìÑ Sobre qual tipo de documento voc√™ quer saber?<br/><br/>
      <button onclick="respondToUser('documento casamento')" class="chat-btn">üë∞ Casamento</button>
      <button onclick="respondToUser('documento firma')" class="chat-btn">‚úçÔ∏è Firma</button>
    `;
    chatBox.appendChild(msg);
    if (message.includes("documento casamento")) {
      addMessage("Bot", "üë∞ √â necess√°rio a certid√£o de registro c√≠vil atualizada, RG e CPF dos noivos, e o formul√°rio preenchido (clique na aba de Registro Civil - Casamento - e baixe o Formul√°rio)");
    }
    else if (message.includes("documento firma")) {
      addMessage("Bot", "Documento com foto (RG ou CNH) e CPF. A firma deve estar aberta no cart√≥rio.");
    }
  }
  
  else {
    addMessage("Bot", "‚ùì Desculpe, n√£o entendi. Voc√™ pode perguntar sobre: documentos, hor√°rio, valores ou falar com um atendente.");
  }

  chatBox.scrollTop = chatBox.scrollHeight;
}

function botoes() {
  const msg = document.createElement("div");
  msg.innerHTML = `
    <strong>Bot:</strong> üëã Ol√°! Como posso ajudar?<br/><br/>
    <button onclick="respondToUser('documento')" class="chat-btn">üìÑ Documentos</button>
    <button onclick="respondToUser('hor√°rio')" class="chat-btn">üïí Hor√°rio</button>
    <button onclick="respondToUser('valor')" class="chat-btn">üí∞ Valores</button>
    <button onclick="respondToUser('atendente')" class="chat-btn">üìû Atendente</button>
    <button onclick="respondToUser('certidao')" class="chat-btn">üìú Certid√µes</button>
  `;
  chatBox.appendChild(msg);
  chatBox.scrollTop = chatBox.scrollHeight;
}

window.onload = botoes;

let isDragging = false, offsetX, offsetY;


if (chatWidget && chatHeader) {
  chatHeader.addEventListener('mousedown', function(e) {
    isDragging = true;
    offsetX = e.clientX - chatWidget.getBoundingClientRect().left;
    offsetY = e.clientY - chatWidget.getBoundingClientRect().top;
    chatWidget.style.transition = 'none';
  });

  document.addEventListener('mousemove', function(e) {
    if (isDragging) {
      chatWidget.style.left = (e.clientX - offsetX) + 'px';
      chatWidget.style.top = (e.clientY - offsetY) + 'px';
      chatWidget.style.right = 'auto';
      chatWidget.style.bottom = 'auto';
      chatWidget.style.position = 'fixed';
    }
  });

  document.addEventListener('mouseup', function() {
    isDragging = false;
    chatWidget.style.transition = '';
  });
}